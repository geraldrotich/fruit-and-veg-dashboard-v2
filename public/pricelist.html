<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fruit & Veg Dashboard - Pricelist</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lexend&display=swap">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <style>
    body {
      font-family: 'Lexend', sans-serif;
      margin: 20px;
    }

    .tabs {
      display: flex;
      margin-bottom: 20px;
      gap: 10px;
    }

    .tab {
      padding: 10px 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
    }

    .tab.active {
      background-color: #008601;
      color: white;
      font-weight: bold;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .form {
      margin-bottom: 20px;
    }

    input, select {
      padding: 8px;
      margin: 5px;
    }

    button {
      padding: 8px 12px;
      background-color: #008601;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .card:hover {
      background-color: #f9f9f9;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 5px;
      font-size: 12px;
      color: white;
      text-transform: capitalize;
    }

    .organic { background-color: green; }
    .conventional { background-color: orange; }
    .imported { background-color: purple; }

    .vendor-entry {
      margin-left: 20px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" onclick="switchTab('products')">Products</div>
    <div class="tab" onclick="switchTab('vendors')">Vendors</div>
  </div>

  <div id="products" class="section active">
    <form class="form" onsubmit="addProduct(event)">
      <input type="text" id="product-name" placeholder="Product Name" required />
      <select id="product-type" required>
        <option value="">Select Type</option>
        <option value="organic">Organic</option>
        <option value="conventional">Conventional</option>
        <option value="imported">Imported</option>
      </select>
      <input type="text" id="vendor-name" placeholder="Vendor Name" required />
      <input type="text" id="unit" placeholder="Unit (kg, g, etc.)" required />
      <input type="number" id="price" placeholder="Unit Price" required />
      <button type="submit">Add Product</button>
    </form>

    <div id="product-list"></div>
  </div>

  <div id="vendors" class="section">
    <form class="form" onsubmit="addVendor(event)">
      <input type="text" id="new-vendor-name" placeholder="New Vendor Name" required />
      <button type="submit">Add Vendor</button>
    </form>

    <div id="vendor-list"></div>
  </div>

  <script>
    // Firebase Config (replace with your actual config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
      document.getElementById(tab).classList.add('active');
    }

    function addProduct(e) {
      e.preventDefault();
      const name = document.getElementById("product-name").value.trim();
      const type = document.getElementById("product-type").value;
      const vendor = document.getElementById("vendor-name").value.trim();
      const unit = document.getElementById("unit").value.trim();
      const price = parseFloat(document.getElementById("price").value);

      db.collection("products").add({ name, type, vendor, unit, price }).then(() => {
        alert("Product added!");
        loadProducts();
        e.target.reset();
      });
    }

    function addVendor(e) {
      e.preventDefault();
      const name = document.getElementById("new-vendor-name").value.trim();
      db.collection("vendors").add({ name }).then(() => {
        alert("Vendor added!");
        loadVendors();
        e.target.reset();
      });
    }

    function loadProducts() {
      db.collection("products").orderBy("name").get().then(snapshot => {
        const container = document.getElementById("product-list");
        container.innerHTML = "";
        const grouped = {};

        snapshot.forEach(doc => {
          const data = doc.data();
          if (!grouped[data.name]) grouped[data.name] = [];
          grouped[data.name].push(data);
        });

        Object.keys(grouped).sort().forEach(productName => {
          const items = grouped[productName];
          const type = items[0].type;

          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<strong>${productName}</strong> <span class="tag ${type}">${type}</span>`;

          let expanded = false;
          card.addEventListener("click", () => {
            if (expanded) {
              card.innerHTML = `<strong>${productName}</strong> <span class="tag ${type}">${type}</span>`;
              expanded = false;
            } else {
              items.forEach(item => {
                card.innerHTML += `
                  <div class="vendor-entry">
                    Vendor: ${item.vendor}<br>
                    Unit: ${item.unit}<br>
                    Price: ${item.price}
                  </div>`;
              });
              expanded = true;
            }
          });

          container.appendChild(card);
        });
      });
    }

    function loadVendors() {
      db.collection("vendors").get().then(vendorSnap => {
        const vendorList = document.getElementById("vendor-list");
        vendorList.innerHTML = "";

        vendorSnap.forEach(vendorDoc => {
          const vendorData = vendorDoc.data();
          const vendorCard = document.createElement("div");
          vendorCard.className = "card";
          vendorCard.textContent = vendorData.name;

          let expanded = false;
          vendorCard.addEventListener("click", () => {
            if (expanded) {
              vendorCard.textContent = vendorData.name;
              expanded = false;
            } else {
              db.collection("products").where("vendor", "==", vendorData.name).get().then(prodSnap => {
                vendorCard.innerHTML = `<strong>${vendorData.name}</strong>`;
                prodSnap.forEach(prodDoc => {
                  const item = prodDoc.data();
                  vendorCard.innerHTML += `
                    <div class="vendor-entry">
                      Product: ${item.name}<br>
                      Unit: ${item.unit}<br>
                      Price: ${item.price}
                    </div>`;
                });
              });
              expanded = true;
            }
          });

          vendorList.appendChild(vendorCard);
        });
      });
    }

    window.onload = () => {
      loadProducts();
      loadVendors();
    };
  </script>
</body>
</html>
